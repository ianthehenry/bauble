#!/usr/bin/env bash
set -euo pipefail
cd $(dirname "$0")

embabule_iife=$1
embabule_cjs=$2
embabule_esm=$3

(
  cat preamble.md
  echo
  (cd ../../../build && janet -i docs.jimage $(git rev-parse HEAD))
  echo
  sed appendices.md \
    -e "s|PLACEHOLDER_EMBAUBLE_IIFE|$embabule_iife|g" \
    -e "s|PLACEHOLDER_EMBAUBLE_CJS|$embabule_cjs|g" \
    -e "s|PLACEHOLDER_EMBAUBLE_ESM|$embabule_esm|g"
) | pandoc --from markdown-auto_identifiers --to html --wrap=preserve
